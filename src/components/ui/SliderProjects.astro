---
import type { CollectionEntry } from "astro:content";
import CardProyect from "./CardProyect.astro";

interface Props {
  items: CollectionEntry<"projects">[];
  interval?: number;
  direction?: "left" | "right";
}

const { items, interval = 4000, direction = "right" } = Astro.props;
---

<div class="relative w-full overflow-hidden">
  <div
    class="slider flex transition-transform duration-700 ease-in-out"
    data-interval={interval}
    data-direction={direction}
  >
    {
      items.map(({ id, data }, index) => {
        const { title, description, image } = data;
        return (
          <div
            class="flex w-full flex-shrink-0 flex-col items-center justify-center p-4 transition-all duration-500 sm:w-1/2 lg:w-1/3"
            data-index={index}
          >
            <CardProyect
              id={id}
              title={title}
              description={description}
              image={image}
              lazy
            />
          </div>
        );
      })
    }
  </div>
</div>

<script is:inline data-astro-rerun>
(function () {
  const sliders = document.querySelectorAll(".slider");

  sliders.forEach((slider) => {
    const slides = slider.children;
    const total = slides.length;
    const interval = Number(slider.dataset.interval) || 4000;
    const direction = slider.dataset.direction || "right";
    let current = 0;

    function getVisibleCount() {
      if (window.innerWidth >= 1024) return 3;
      if (window.innerWidth >= 640) return 2;
      return 1;
    }

    function updateSlides() {
      const visible = getVisibleCount();
      const step = 100 / visible;
      slider.style.transform = `translateX(-${current * step}%)`;
    }

    setInterval(() => {
      const visible = getVisibleCount();
      const maxIndex = total - visible;
      current =
        direction === "right"
          ? (current + 1) % (maxIndex + 1)
          : (current - 1 + (maxIndex + 1)) % (maxIndex + 1);
      updateSlides();
    }, interval);

    window.addEventListener("resize", updateSlides);
    updateSlides();
  });
})();
</script>
