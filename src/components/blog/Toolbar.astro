---
import Search from "@assets/icons/Search.astro";

interface Props {
  categories: string[];
}

const { categories } = Astro.props;
---

<section class="flex flex-col items-center justify-between gap-6 md:flex-row">
  <!-- Category Filters -->
  <div id="categoryFilters" class="flex flex-wrap gap-3 overflow-x-auto md:overflow-visible">
    {categories.map((category) => (
      <button
        id={category}
        class="category-btn rounded-full border px-4 py-2 whitespace-nowrap transition-colors duration-300 border-secondary hover:bg-secondary hover:text-primary"
      >
        {category}
      </button>
    ))}
  </div>

  <!-- Search -->
  <div class="relative w-full md:w-72">
    <input
      id="searchInput"
      type="text"
      placeholder="Search posts..."
      class="border-secondary/18 focus:border-secondary w-full rounded-full border bg-transparent py-2 pr-10 pl-4 text-sm focus:outline-none"
      aria-label="Search blog posts"
    />
    <Search styles="absolute right-3 top-1/2 -translate-y-1/2 size-5" />
  </div>
</section>

<script>
  const input = document.querySelector("#searchInput")!;
  const items = document.querySelectorAll(".postItem"); // tus posts deben tener class="postItem" y un atributo data-category + data-title
  const categoryButtons = document.querySelectorAll(".category-btn")!;

  let selectedCategory = "";

  // --- Buscar por título ---
  input.addEventListener("input", (e: any) => {
    const query = e.target.value.toLowerCase();
    filterPosts(query, selectedCategory);
  });

  // --- Filtrar por categoría ---
  categoryButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      // Resetear estilos de botones
      categoryButtons.forEach((b) => {
        b.classList.remove("bg-secondary", "text-primary");
        b.classList.add("bg-transparent", "text-secondary");
      });

      // Activar estilo en el botón seleccionado
      btn.classList.remove("bg-transparent", "text-secondary");
      btn.classList.add("bg-secondary", "text-primary");

      // Guardar categoría seleccionada
      selectedCategory = btn.id !== "All" ? btn.id : "" ;
      filterPosts(input.value.toLowerCase() || "", selectedCategory);
    });
  });

  // --- Función que combina búsqueda + categoría ---
  function filterPosts(query: string, category: string) {
    items.forEach((item) => {
      const title = item.getAttribute("data-title")?.toLowerCase() || "";
      const cat = item.getAttribute("data-category") || "";

      const matchesQuery = title.includes(query);
      const matchesCategory = !category || category === cat;

      item.style.display = matchesQuery && matchesCategory ? "flex" : "none";
    });
  }
</script>
